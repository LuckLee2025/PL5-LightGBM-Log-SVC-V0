# 排列五数据处理与分析系统

## 1. pl5_data_processor.py - 数据获取与预处理

### 主要功能
这个脚本负责从网络上获取排列五历史开奖数据，并将其保存为标准化的CSV文件。

### 核心逻辑流程
1. **数据获取**：
   - 从网络文本文件获取数据（`fetch_pl5_data`）- 从 https://data.17500.cn/pl5_asc.txt 获取
   - 支持自动去除日期信息，保留期号和5位数字

2. **数据解析**：
   - 解析文本数据（`parse_txt_data`）- 将原始文本转换为结构化数据
   - 验证数字范围（0-9）和数据完整性

3. **数据存储**：
   - 保存为CSV文件（`pl5.csv`）
   - 按期号升序排序
   - 数据格式：Seq, pos_1, pos_2, pos_3, pos_4, pos_5

4. **错误处理**：
   - 多种编码尝试（utf-8, gbk, latin-1）
   - 网络连接错误处理
   - 数据格式验证

### 技术特点
- 使用requests库进行网络请求
- 使用pandas进行数据处理和CSV操作
- 实现了日志系统和进度显示
- 自动备份现有数据文件

## 2. pls_analyzer.py - 数据分析与预测

### 主要功能
这个脚本负责分析排列五历史数据，识别模式，训练机器学习模型，并生成下一期的推荐号码组合。

### 核心逻辑流程
1. **数据加载与预处理**：
   - 加载CSV数据（`load_data`）
   - 数据清理和结构化（`clean_and_structure`）
   - 特征工程（`feature_engineer`）- 创建和值、跨度、奇偶计数、大小分布等特征

2. **历史统计分析**：
   - 频率和遗漏分析（`analyze_frequency_omission`）- 分析各位置号码的出现频率和遗漏情况
   - 模式分析（`analyze_patterns`）- 分析奇偶比、大小比、和值分布、跨度分布等
   - 关联规则挖掘（`analyze_associations`）- 使用Apriori算法挖掘号码关联关系

3. **机器学习模型训练**：
   - 创建滞后特征（`create_lagged_features`）
   - 训练多种模型（`train_prediction_models`）：
     - LightGBM分类器 - 为每个位置的每个数字训练独立模型
   - 预测下一期号码概率（`predict_next_draw_probabilities`）

4. **号码评分与组合生成**：
   - 计算综合得分（`calculate_scores`）- 结合频率、遗漏和ML预测概率
   - 生成推荐组合（`generate_combinations`）- 基于得分和历史模式
   - 应用多样性控制确保推荐组合的差异性

5. **特色功能**：
   - 支持反向思维策略（可选）
   - 模式匹配奖励（奇偶比、大小比、和值范围）
   - 关联规则奖励

6. **结果输出**：
   - 生成详细分析报告
   - 推荐10注号码组合
   - 包含详细的评分分析

### 排列五特色特征
- **和值特征**：五位数字之和（0-45）
- **跨度特征**：最大数字与最小数字的差值
- **奇偶特征**：奇数个数统计（0-5）
- **大小特征**：大数（5-9）个数统计（0-5）
- **质合特征**：质数（2,3,5,7）个数统计
- **形态特征**：数字重复模式分类（五个都不同、一对相同、两对、三个相同、四个相同、五个相同）
- **连号特征**：连续数字的个数
- **重复特征**：重复数字的个数

### 技术特点
- 使用LightGBM进行机器学习预测
- 实现了特征工程和滞后特征创建
- 使用关联规则挖掘（Apriori算法）
- 采用模块化设计，功能分离清晰
- 支持Optuna参数优化（可选）

## 3. pls_bonus_calculation.py - 奖金计算器

### 主要功能
这个脚本负责验证推荐号码的实际表现，计算中奖情况和奖金。

### 核心逻辑流程
1. **数据匹配**：
   - 读取历史开奖数据
   - 查找对应期号的分析报告
   - 解析推荐号码

2. **中奖验证**：
   - 直选验证：五个位置完全匹配

3. **奖金计算**：
   - 直选：100,000元（10万元）

4. **报告生成**：
   - 记录验证结果到 `latest_pl5_calculation.txt`
   - 保留最近10次验证记录

## 4. pls_wxpusher.py - 微信推送功能

### 主要功能
提供微信推送功能，用于推送排列五分析报告和验证结果。

### 核心功能
1. **分析报告推送**：
   - 推送每期的预测报告
   - 包含推荐号码和分析摘要
   - 显示上期验证结果

2. **验证报告推送**：
   - 推送中奖验证结果
   - 显示开奖号码和中奖情况

3. **错误通知**：
   - 系统异常时发送通知
   - 日常运行状态报告

## 系统整体效果

这个排列五分析系统具有以下特点：

1. **数据流向**：
   - `pl5_data_processor.py` 负责获取和预处理数据，生成标准化CSV
   - `pls_analyzer.py` 读取CSV，进行分析和预测

2. **系统优势**：
   - **数据获取的健壮性**：稳定的数据源，多编码支持，错误处理
   - **分析的全面性**：结合统计分析和机器学习
   - **预测的科学性**：基于大量历史数据训练
   - **可验证性**：通过实际开奖结果验证预测效果

3. **排列五专业特色**：
   - **适配排列五规则**：5位数字，每位0-9，允许重复，有序排列
   - **专业特征工程**：和值、跨度、奇偶比、大小比、质合比等
   - **形态分析**：数字重复模式的识别和分析
   - **位置特化**：为每个位置独立分析和预测

4. **实际应用效果**：
   - 系统能够基于历史数据识别排列五的特有模式
   - 使用机器学习预测各位置各数字的出现概率
   - 生成综合评分较高的号码组合
   - 提供详细的分析报告和可视化结果

## 快速开始

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **获取数据**：
   ```bash
   python pl5_data_processor.py
   ```

3. **运行分析**：
   ```bash
   python pls_analyzer.py
   ```

4. **验证结果**（在有新开奖后）：
   ```bash
   python pls_bonus_calculation.py
   ```

## 配置说明

- 修改 `pls_analyzer.py` 中的 `DEFAULT_WEIGHTS` 可调整算法权重
- 修改 `ENABLE_OPTUNA_OPTIMIZATION` 可启用参数优化
- 微信推送需要配置 `WXPUSHER_APP_TOKEN` 等环境变量

## GitHub 同步与部署指南

### 将项目同步到GitHub仓库

如果您需要将本地项目同步到GitHub仓库 `https://github.com/LJQ-HUB-cmyk/PL5-LightGBM-Log-SVC`，请按照以下步骤操作：

#### 第一次同步（初始化）

1. **初始化本地Git仓库**：
   ```bash
   git init
   ```

2. **添加远程仓库**：
   ```bash
   git remote add origin https://github.com/LJQ-HUB-cmyk/PL5-LightGBM-Log-SVC.git
   ```

3. **添加文件并提交**：
   ```bash
   git add .
   git commit -m "初始化排列五分析系统"
   ```

4. **推送到远程仓库**：
   ```bash
   git push -u origin main
   ```

#### 后续更新同步

1. **添加修改的文件**：
   ```bash
   git add .
   ```

2. **提交修改**：
   ```bash
   git commit -m "更新说明"
   ```

3. **推送到远程**：
   ```bash
   git push
   ```

### GitHub Actions 自动化部署

可以设置GitHub Actions来自动运行分析和推送结果：

1. 在仓库根目录创建 `.github/workflows/pl5_analysis.yml`
2. 配置自动运行脚本的时间和条件
3. 设置必要的环境变量（微信推送Token等）

## 系统特点

### 排列五与排列三的主要区别

1. **数字位数**：从3位扩展到5位
2. **组合空间**：从1000种扩展到100000种
3. **中奖概率**：直选中奖概率为1/100000
4. **奖金金额**：直选奖金为10万元
5. **特征工程**：适配5位数字的特征分析

### 算法优势

1. **机器学习驱动**：使用LightGBM算法进行概率预测
2. **多维特征**：结合频率、遗漏、模式等多种特征
3. **参数优化**：支持Optuna自动参数调优
4. **实时验证**：自动验证预测效果并记录

### 数据来源

- **主数据源**：https://data.17500.cn/pl5_asc.txt
- **数据格式**：期号 + 5位数字
- **更新频率**：每日开奖后更新
- **历史深度**：支持所有历史期号数据

## 注意事项

1. **投资风险**：彩票具有随机性，本系统仅供数据分析参考
2. **数据依赖**：系统依赖网络数据源，需要稳定的网络连接
3. **计算资源**：机器学习训练需要一定的计算时间和内存
4. **更新维护**：建议定期更新数据和检查系统运行状态
